define(["jquery","core/ajax","core/notification","core/str","core/templates","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){function h(a,d,f,g){var h=a.getBody(),i=a.getFooter(),j=i.find('[data-action="refresh"]'),k=j.width(),l=i.find(".loading-icon");j.hide(),l.css({marginLeft:k/2+"px",marginRight:k/2+"px"}),l.show();var m=b.call([{methodname:"assignfeedback_structured_get_criteriasets",args:{contextid:d,includeshared:!f}}]);m[0].done(function(a){var b={contextId:d,manage:f,canPublish:g,ownedSets:a.ownedsets,sharedSets:a.sharedsets};e.render("assignfeedback_structured/criteriasets",b).done(function(a,b){e.replaceNodeContents(h,a,b),l.hide(),j.show()}).fail(c.exception)}).fail(c.exception)}var i={init:function(b,i,j,k,l){if(d.get_strings([{key:"criteriasetssaved",component:"assignfeedback_structured"},{key:"criteriasetsmanage",component:"assignfeedback_structured"}]).done(function(d){var m={contextId:b,manage:i,canPublish:j,ownedSets:k,sharedSets:l},n={manage:i},o=d[0],p=a("#id_assignfeedback_structured_critset");i&&(o=d[1],p=a("#id_assignfeedback_structured_critsetsmanage")),e.render("assignfeedback_structured/criteriasets_footer",n).done(function(a){f.create({title:o,body:e.render("assignfeedback_structured/criteriasets",m),footer:a,large:!1},p).done(function(a){var c=a.getFooter().find('[data-action="refresh"]');c.on("click",function(){h(a,b,i,j)}),a.getRoot().on(g.shown,function(){h(a,b,i,j)})}).fail(c.exception)}).fail(c.exception)}),!i){var m=a("#id_assignfeedback_structured_critset");e.render("core/loading",{}).done(function(a,b){e.appendNodeContents(m.parent(),a,b),m.siblings(".loading-icon").hide()}).fail(c.exception)}}};return i});